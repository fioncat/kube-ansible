---
- name: group nodes
  set_fact:
    etcd_nodes: "{% set nodes={} %}{% for host in groups['etcd'] %}{% set hostvar=hostvars[host] %}{% if 'node' in hostvar %}{% set x=nodes.__setitem__(hostvar['node'], hostvar) %}{% else %}{% set x=nodes.__setitem__(host, hostvar) %}{% endif %}{% endfor %}{{ nodes }}"
    master_nodes: "{% set nodes={} %}{% for host in groups['nodes'] %}{% set hostvar=hostvars[host] %}{% if hostvar['role'] == 'master' %}{% if 'node' in hostvar %}{% set x=nodes.__setitem__(hostvar['node'], hostvar) %}{% else %}{% set x=nodes.__setitem__(host, hostvar) %}{% endif %}{% endif %}{% endfor %}{{ nodes }}"
    worker_nodes: "{% set nodes={} %}{% for host in groups['nodes'] %}{% set hostvar=hostvars[host] %}{% if hostvar['role'] == 'worker' %}{% if 'node' in hostvar %}{% set x=nodes.__setitem__(hostvar['node'], hostvar) %}{% else %}{% set x=nodes.__setitem__(host, hostvar) %}{% endif %}{% endif %}{% endfor %}{{ nodes }}"
    current_node: "{% set hostvar=hostvars[ansible_host] %}{% if 'node' in hostvar %}{{ hostvar['node'] }}{% else %}{{ ansible_host }}{% endif %}"
